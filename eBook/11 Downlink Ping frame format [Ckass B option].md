## 第11章 Class B 模式的下行帧(Class B选项)

### <a name="11.1">11.1 物理层帧格式</a>
一个下行Ping帧使用和Class A下行帧相同的格式但是可能会遵循不同的信道频率规划。

### <a name="11.2">11.2 单播&多播 MAC消息</a>
信息的传播方式可以是“单播”或者“多播”。单播是指将信息传递给一个指定的终端，多播是指将信息传递给多个终端。多播组内的所有终端都必须分享一个相同的多播地址和相关的加密密钥。LoRaWAN协议中的Class B协议并没有明确规定如何远程地去建立一个多播组或者安全地分配多播密钥。这必须通过节点的个性化设置或者应用层来实现。

#### 11.2.1 单播MAC消息格式
一个单播下行Ping帧的MAC载荷使用如Class A协议部分所定义的格式。它由终端以完全相同的方式进行处理。同时也使用相同的帧计数器并且无论下行帧是否使用Class B的ping时隙或者Class A的“piggy-back”时隙，帧计数器都会递增。


#### 11.2.2 多播MAC消息格式
多播帧共享大多数单播帧格式，但有少数例外：

- 因为多播下行数据帧不具备单播数据帧公认的鲁棒性(稳定性)，所以它们不允许携带MAC命令，既不在Fopt字段中，也不在端口0上的有效载荷中。

- **ACK**和**ADRACKReq**位必须为0。 **MType**必须为Unconfirmed Data Down类型的数值。

- **FPending*位用于告知还有很多多播数据需要进行发送。如果这个位被置起则下一个多播数据接收时隙将会接收到一个下行数据帧。如果这个位没被置起则下一个接收时隙无法确定是否会收到一个下行数据帧。这个位可以用于终端评估在接收时隙内下行数据发生冲突的概率。